---
title: "Vueã®script setupã‚’ã‚‚ã£ã¨ä¾¿åˆ©ã«ã™ã‚‹Vue Macros"
emoji: "ğŸ“‘"
type: "tech"
topics:
  - "vue"
  - "vuejs"
  - "vue3"
published: true
published_at: "2022-12-25 00:01"
---

> ã“ã®è¨˜äº‹ã¯[Qiita Vue Advent Calendar 2022](https://qiita.com/advent-calendar/2022/vue)ã®12æœˆ24æ—¥åˆ†ã®è¨˜äº‹ã§ã™ã€‚

Vue 3ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸComposition APIã€ãã—ã¦Vue 3.2ã§æ­£è¦ã‚µãƒãƒ¼ãƒˆã•ã‚ŒãŸscript setupã«ã‚ˆã‚Šã€Vue 3é–‹ç™ºè€…ä½“é¨“ã«ä»¥ä¸‹ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã‚„ä¸å®Œå…¨ã•ãŒã‚‚ãŸã‚‰ã•ã‚Œã¾ã—ãŸã€‚

- Refã‚’ä½¿ç”¨ã—ãŸéš›ã® `.value` ã®æ°¾æ¿«ã¨ã¤ã‘å¿˜ã‚Œ
- `script` ã¨ `script setup` ã®ä½µç”¨ï¼ˆOptions APIã¨Composition APIã®ä½µç”¨ï¼‰

å‰è€…ã«é–¢ã—ã¦ã¯ã€[Reactivity Transform](https://vuejs.org/guide/extras/reactivity-transform.html#refs-vs-reactive-variables)ã®ç™»å ´ã§è§£æ±ºã•ã‚Œã‚‹æ–¹å‘ã«å‘ã‹ã£ã¦ã„ã¾ã™ãŒã€å¾Œè€…ã«é–¢ã—ã¦ã¯ã€ç­†è€…ã®çŸ¥ã‚‹é™ã‚ŠVueã‚³ã‚¢ã§ã®è§£æ±ºç­–ã¯ã¾ã ç™ºè¡¨ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

ã“ã®è¨˜äº‹ã§ã¯ã€å¾Œè€…ã®å•é¡Œã«å¯¾ã™ã‚‹è§£æ±ºç­–ã¨ã—ã¦[Vue Macros](https://vue-macros.sxzz.moe/)ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚ãŠãã‚‰ã

## script setupã®é™ç•Œ

script setupã«ã¯ä¸€éƒ¨ã®Vueã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨˜è¿°ã§ããªã„ãŸã‚ã€Options APIã¨ã®ä½µç”¨ãŒå¿…è¦ã§ã™ï¼ˆ(å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ)[https://vuejs.org/api/sfc-script-setup.html#usage-alongside-normal-script]ï¼‰ã€‚

```vue
<script>
export default {
  name: 'MyComponent',
  inheritAttrs: false,
  myCustomOptions: {},
  props: {
    myProp: {
      type: Object as PropType<MyType>,
      default () {
        return { key: 'value' }
      }
    }
  },
  setup () {
    const firstName = ref('Jonh')
    const lastName = ref('Doe')
    const fullName = computed(() => firstName.value + ' ' + lastName.value)

    return {
      firstName,
      lastName,
      fullName
    }
  }
}
</script>
```

```vue
<script>
export default {
  name: 'MyComponent',
  inheritAttrs: false,
  myCustomOptions: {},
  props: {
    myProp: {
      type: Object as PropType<MyType>,
      default () {
        return { key: 'value' }
      }
    }
  }
}
</script>

<script setup>
const firstName = ref('Jonh')
const lastName = ref('Doe')
const fullName = computed(() => firstName.value + ' ' + lastName.value)
</script>
```

ã»ã¨ã‚“ã©ã®è¨˜è¿°ã¯setupé–¢æ•°ã«ã‚ã‚‹ã®ã§script setupã«æŠœãå‡ºã›ã¾ã™ãŒã€ã›ã£ã‹ããªã‚‰script setupã ã‘ã§ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ã—ãŸã„ã¨ã“ã‚ã§ã™ã€‚

## ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒã‚¯ãƒ­

ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒã‚¯ãƒ­ã¨ã¯ã€è¦‹ãŸç›®ã¯é€šå¸¸ã®JavaScript/TypeScriptã®ã‚³ãƒ¼ãƒ‰ã§ã™ãŒã€Vue SFCã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã™ã‚‹éš›ã«åˆ¥ã®ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›ã•ã‚Œã‚‹ã‚‚ã®ã§ã€é–‹ç™ºè€…ä½“é¨“ã®å‘ä¸Šã®ãŸã‚ã«å­˜åœ¨ã™ã‚‹æ§‹æ–‡ã§ã™ã€‚

é€šå¸¸ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ãªã„ãŸã‚ã€importã›ãšã«ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

Vueã‚³ã‚¢ãŒæä¾›ã™ã‚‹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒã‚¯ãƒ­ã¨ã—ã¦ `defineProps` ã‚„ `defineEmits` ãŒã‚ã‚Šã¾ã™ã€‚

`defineProps` ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ï¼ˆ`PropType` ã‚’ä½¿ã‚ãšã«ï¼‰TypeScriptã®å‹å®£è¨€ã§Propsã‚’å®£è¨€ã§ãã‚‹ã“ã¨ã‚’çŸ¥ã£ã¦ã„ã‚‹èª­è€…ã‚‚ã„ã‚‹ã§ã—ã‚‡ã†ã€‚

```vue
<script setup>
withDefaults(defineProps<{ myProp: MyType }>(), {
  myProp: () => ({ key: 'value' })
})
</script>
```

## Vue Macros

Vue Macrosã¯ã€Vueã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒã‚¯ãƒ­ã‚’ã‚ã¤ã‚ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

Vueã‚³ã‚¢ãŒæä¾›ã™ã‚‹ `defineProps` ã‚„ `defineEmits` ã®ä»–ã«Options APIã§ã—ã‹å®šç¾©ã§ããªã‹ã£ãŸVueã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’script setupã«å®šç¾©ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚

ä»¥ä¸‹ã€ä¸€éƒ¨ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

### `defineOptions`

ã“ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒã‚¯ãƒ­ã¯ã€Options APIã§ã—ã‹è¨­å®šã§ããªã‹ã£ãŸã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’script setupã§è¨˜è¿°ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚

è¨˜äº‹ã®å†’é ­ã§ç¤ºã—ãŸã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã§ãã¾ã™ï¼ˆ`defineProps` ã‚‚ä½¿ç”¨ã—ã¦ã„ã¾ã™ï¼‰ã€‚

```vue
<script setup lang="ts">
defineOptions({
  name: 'MyComponent',
  inheritAttrs: false,
  myCustomOptions: {}
})

withDefaults(defineProps<{ myProp: MyType }>(), {
  myProp: () => ({ key: 'value' })
})

const firstName = ref('Jonh')
const lastName = ref('Doe')
const fullName = computed(() => firstName.value + ' ' + lastName.value)
</script>
```

### `defineModel`

`v-model` ã‚’ä½¿ç”¨ã—ãŸåŒæ–¹å‘ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã®ãŸã‚ã« `props` ã¨ `emits` ã‚’å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒã‚¯ãƒ­ã«ã‚ˆã£ã¦è¨˜è¿°ã‚’ç°¡æ½”ã«ã§ãã¾ã™ã€‚

ä»¥ä¸‹ã€å…¬å¼ã‚µã‚¤ãƒˆã‹ã‚‰ã®å¼•ç”¨ã§ã™ï¼ˆ[ãƒªãƒ³ã‚¯](https://vue-macros.sxzz.moe/macros/define-model.html#with-reactivity-transform)ï¼‰ã€‚

```vue
<script setup lang="ts">
let { modelValue, count } = $defineModel<{
  modelValue: string
  count: number
}>()

console.log(modelValue)
modelValue = 'newValue'
count++
</script>
```

```vue
<script setup lang="ts">
const { modelValue, count } = defineProps<{
  modelValue: string
  count: number
}>()

const emit = defineEmits<{
  (evt: 'update:modelValue', value: string): void
  (evt: 'update:count', value: number): void
}>()

console.log(modelValue)
emit('update:modelValue', 'newValue')
emit('update:count', count + 1)
</script>
```

ãã®ä»–ã€script setupã®ä¸­ã§JSXã®renderé–¢æ•°ã‚’å®šç¾©ã§ãã‚‹ [`defineRender`](https://vue-macros.sxzz.moe/macros/define-render.html) ã‚„ã€Svelteã«è¿‘ã„ã‚¹ã‚¿ã‚¤ãƒ«ã§ `.jsx` `.tsx` ã‚’è¨˜è¿°ã§ãã‚‹ [`setupSFC`](https://vue-macros.sxzz.moe/macros/setup-sfc.html) ãªã©ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒã‚¯ãƒ­ã‚‚ã‚ã‚Šã¾ã™ã€‚

---

Vue Macrosã¯ã¾ã ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ0.xãªã®ã§stableã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‹ã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒæ´»ç™ºã«ãªã‚Œã°ã€Vueã‚³ã‚¢ã«çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ãã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
